
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Rebar AI - Multi Blueprint Parser</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    input, button { margin-top: 10px; }
    pre { background: #fff; padding: 10px; border: 1px solid #ccc; overflow: auto; max-height: 400px; margin-bottom: 20px; }
    .file-result { margin-bottom: 30px; }
  </style>
</head>
<body>
  <h1>Upload Multiple Rebar Blueprints</h1>
  <input type="file" id="fileInput" multiple />
  <br />
  <button onclick="uploadAndParse()">Upload + Parse All</button>
  <div id="results"></div>

  <script>
    const backendUrl = "https://rebar-ai-backend.onrender.com/api";

    async function uploadAndParse() {
      const input = document.getElementById("fileInput");
      const files = input.files;
      if (!files.length) return alert("Please select at least one file.");

      const formData = new FormData();
      for (let file of files) {
        formData.append("files", file);
      }

      const uploadRes = await fetch(`${backendUrl}/upload-blueprints`, {
        method: "POST",
        body: formData
      });
      const uploadData = await uploadRes.json();

      const parseRes = await fetch(`${backendUrl}/parse-blueprints`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ file_paths: uploadData.files })
      });
      const parsedData = await parseRes.json();

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";
      parsedData.forEach(fileResult => {
        const block = document.createElement("div");
        block.className = "file-result";
        block.innerHTML = `
          <h3>${fileResult.file}</h3>
          <pre>${JSON.stringify(fileResult.bars || fileResult.error, null, 2)}</pre>
        `;
        resultsDiv.appendChild(block);
      });
    }
  </script>
</body>
</html>
